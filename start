#!/bin/bash

set -e

if [[ -n "${GITHUB_PRIVATE_KEY}" ]]; then
  mkdir /root/.ssh
  chmod 700 /root/.ssh
  echo "${GITHUB_PRIVATE_KEY}" > /root/.ssh/id_rsa
  chmod 600 /root/.ssh/id_rsa
fi

if [[ -n "${DOCKERCFG}" ]]; then
  echo "${DOCKERCFG}" > /root/.dockercfg
fi

exec buildkite-agent start $@
